if(void 0===__webpack_require__)var __webpack_require__={};(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[2404],{2653:(s,e,n)=>{n.r(e),n.d(e,{assets:()=>c,contentTitle:()=>r,default:()=>o,frontMatter:()=>t,metadata:()=>a,toc:()=>m});const a=JSON.parse('{"id":"chapter-06/lesson-03","title":"Lesson 6.3: Whole-Body Motion Planning","description":"Inverse kinematics for humanoids, center-of-mass control","source":"@site/i18n/ur/docusaurus-plugin-content-docs/current/chapter-06/lesson-03.md","sourceDirName":"chapter-06","slug":"/chapter-06/lesson-03","permalink":"/physical-ai-book/ur/docs/chapter-06/lesson-03","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"balance","permalink":"/physical-ai-book/ur/docs/tags/balance"},{"inline":true,"label":"inverted-pendulum","permalink":"/physical-ai-book/ur/docs/tags/inverted-pendulum"},{"inline":true,"label":"stabilization","permalink":"/physical-ai-book/ur/docs/tags/stabilization"},{"inline":true,"label":"control","permalink":"/physical-ai-book/ur/docs/tags/control"}],"version":"current","frontMatter":{"title":"Lesson 6.3: Whole-Body Motion Planning","description":"Inverse kinematics for humanoids, center-of-mass control","chapter":6,"lesson":3,"estimated_time":60,"cefr_level":"B2","blooms_level":"Apply","digcomp_level":5,"generated_by":"claude-sonnet-4-5-20250929","source_spec":"specs/002-physical-ai-textbook/spec.md","created":"2025-11-29","last_modified":"2025-11-29","git_author":"hswat","workflow":"/sp.implement","version":"1.0","prerequisites":["chapter-04-lesson-03","chapter-06-lesson-02"],"has_interactive_python":false,"interactive_python_count":0,"has_try_with_ai":true,"try_with_ai_count":2,"tags":["balance","inverted-pendulum","stabilization","control"]},"sidebar":"tutorialSidebar","previous":{"title":"Lesson 6.2: Balance Control","permalink":"/physical-ai-book/ur/docs/chapter-06/lesson-02"},"next":{"title":"Lesson 6.4: Compliant Control","permalink":"/physical-ai-book/ur/docs/chapter-06/lesson-04"}}');var i=n(4848),l=n(8453);const t={title:"Lesson 6.3: Whole-Body Motion Planning",description:"Inverse kinematics for humanoids, center-of-mass control",chapter:6,lesson:3,estimated_time:60,cefr_level:"B2",blooms_level:"Apply",digcomp_level:5,generated_by:"claude-sonnet-4-5-20250929",source_spec:"specs/002-physical-ai-textbook/spec.md",created:"2025-11-29",last_modified:"2025-11-29",git_author:"hswat",workflow:"/sp.implement",version:"1.0",prerequisites:["chapter-04-lesson-03","chapter-06-lesson-02"],has_interactive_python:!1,interactive_python_count:0,has_try_with_ai:!0,try_with_ai_count:2,tags:["balance","inverted-pendulum","stabilization","control"]},r="Lesson 6.3: Balance Control",c={},m=[{value:"Introduction",id:"introduction",level:2},{value:"1. Whole-Body Inverse Kinematics",id:"1-whole-body-inverse-kinematics",level:2},{value:"2. Center of Mass (CoM) Control",id:"2-center-of-mass-com-control",level:2},{value:"3. Task Prioritization",id:"3-task-prioritization",level:2},{value:"Interactive Exercises",id:"interactive-exercises",level:2},{value:"Exercise 6.3.1: Center of Mass Calculator",id:"exercise-631-center-of-mass-calculator",level:3},{value:"Exercise 6.3.2: CoM Jacobian and Control",id:"exercise-632-com-jacobian-and-control",level:3},{value:"Exercise 6.3.3: Task Prioritization (CoM + End-Effector)",id:"exercise-633-task-prioritization-com--end-effector",level:3},{value:"Exercise 6.3.4: Joint Limit Avoidance",id:"exercise-634-joint-limit-avoidance",level:3},{value:"TryWithAI Exercises",id:"trywithai-exercises",level:2},{value:"TryWithAI 6.3.1: Reaching While Walking",id:"trywithai-631-reaching-while-walking",level:3},{value:"TryWithAI 6.3.2: Self-Collision Avoidance",id:"trywithai-632-self-collision-avoidance",level:3},{value:"Summary",id:"summary",level:2}];function h(s){const e={a:"a",annotation:"annotation",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",math:"math",mfrac:"mfrac",mi:"mi",mn:"mn",mo:"mo",mover:"mover",mrow:"mrow",msub:"msub",msubsup:"msubsup",msup:"msup",mtext:"mtext",munder:"munder",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,l.R)(),...s.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"lesson-63-balance-control",children:"Lesson 6.3: Balance Control"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Prerequisites"}),": ",(0,i.jsx)(e.a,{href:"../chapter-04/lesson-03.md",children:"Chapter 4: Inverse Kinematics"}),", ",(0,i.jsx)(e.a,{href:"/physical-ai-book/ur/docs/chapter-06/lesson-02",children:"Lesson 6.2: Bipedal Locomotion Basics"})]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(e.p,{children:"Humanoid robots have many degrees of freedom (typically 20-40 joints), creating complex motion planning challenges. Whole-body planning coordinates all joints to achieve task goals while maintaining balance, respecting joint limits, and avoiding self-collisions. This lesson covers inverse kinematics for redundant systems, center-of-mass constraints, and prioritized task control."}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Learning Objectives"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Formulate whole-body IK with multiple constraints"}),"\n",(0,i.jsx)(e.li,{children:"Implement center-of-mass (CoM) control during manipulation"}),"\n",(0,i.jsx)(e.li,{children:"Use task prioritization for redundancy resolution"}),"\n",(0,i.jsx)(e.li,{children:"Plan collision-free whole-body motions"}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"1-whole-body-inverse-kinematics",children:"1. Whole-Body Inverse Kinematics"}),"\n",(0,i.jsxs)(e.p,{children:["For a humanoid with ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsx)(e.mi,{children:"n"})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"n"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.4306em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"n"})]})})]})," joints and multiple task constraints (hand position, CoM, orientation), we solve:"]}),"\n",(0,i.jsx)(e.span,{className:"katex-display",children:(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsxs)(e.munder,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"min"}),(0,i.jsx)(e.mo,{children:"\u2061"})]}),(0,i.jsx)(e.mi,{mathvariant:"bold",children:"q"})]}),(0,i.jsxs)(e.munder,{children:[(0,i.jsx)(e.mo,{children:"\u2211"}),(0,i.jsx)(e.mi,{children:"i"})]}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"w"}),(0,i.jsx)(e.mi,{children:"i"})]}),(0,i.jsx)(e.mi,{mathvariant:"normal",children:"\u2225"}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"J"}),(0,i.jsx)(e.mi,{children:"i"})]}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsx)(e.mi,{mathvariant:"bold",children:"q"}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"}),(0,i.jsxs)(e.mover,{accent:"true",children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"q"}),(0,i.jsx)(e.mo,{children:"\u02d9"})]}),(0,i.jsx)(e.mo,{children:"\u2212"}),(0,i.jsxs)(e.msubsup,{children:[(0,i.jsxs)(e.mover,{accent:"true",children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"x"}),(0,i.jsx)(e.mo,{children:"\u02d9"})]}),(0,i.jsx)(e.mi,{children:"i"}),(0,i.jsx)(e.mi,{children:"d"})]}),(0,i.jsxs)(e.msup,{children:[(0,i.jsx)(e.mi,{mathvariant:"normal",children:"\u2225"}),(0,i.jsx)(e.mn,{children:"2"})]}),(0,i.jsx)(e.mo,{children:"+"}),(0,i.jsx)(e.mi,{children:"\u03bb"}),(0,i.jsx)(e.mi,{mathvariant:"normal",children:"\u2225"}),(0,i.jsxs)(e.mover,{accent:"true",children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"q"}),(0,i.jsx)(e.mo,{children:"\u02d9"})]}),(0,i.jsxs)(e.msup,{children:[(0,i.jsx)(e.mi,{mathvariant:"normal",children:"\u2225"}),(0,i.jsx)(e.mn,{children:"2"})]})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\min_{\\mathbf{q}} \\sum_i w_i \\| \\mathbf{J}_i(\\mathbf{q}) \\dot{\\mathbf{q}} - \\dot{\\mathbf{x}}_i^d \\|^2 + \\lambda \\| \\dot{\\mathbf{q}} \\|^2"})]})})}),(0,i.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"2.3277em",verticalAlign:"-1.2777em"}}),(0,i.jsx)(e.span,{className:"mop op-limits",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.6679em"},children:[(0,i.jsxs)(e.span,{style:{top:"-2.4em",marginLeft:"0em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:(0,i.jsx)(e.span,{className:"mord mathbf mtight",children:"q"})})})]}),(0,i.jsxs)(e.span,{style:{top:"-3em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{children:(0,i.jsx)(e.span,{className:"mop",children:"min"})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.8361em"},children:(0,i.jsx)(e.span,{})})})]})}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsx)(e.span,{className:"mop op-limits",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"1.05em"},children:[(0,i.jsxs)(e.span,{style:{top:"-1.8723em",marginLeft:"0em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3.05em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]}),(0,i.jsxs)(e.span,{style:{top:"-3.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3.05em"}}),(0,i.jsx)(e.span,{children:(0,i.jsx)(e.span,{className:"mop op-symbol large-op",children:"\u2211"})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"1.2777em"},children:(0,i.jsx)(e.span,{})})})]})}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"w"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0269em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mord",children:"\u2225"}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathbf",children:"J"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsx)(e.span,{className:"mord mathbf",children:"q"}),(0,i.jsx)(e.span,{className:"mclose",children:")"}),(0,i.jsx)(e.span,{className:"mord accent",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.6813em"},children:[(0,i.jsxs)(e.span,{style:{top:"-3em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"mord mathbf",children:"q"})]}),(0,i.jsxs)(e.span,{style:{top:"-3.0134em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"accent-body",style:{left:"-0.0556em"},children:(0,i.jsx)(e.span,{className:"mord",children:"\u02d9"})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.1944em"},children:(0,i.jsx)(e.span,{})})})]})}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1.1491em",verticalAlign:"-0.25em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord accent",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.6813em"},children:[(0,i.jsxs)(e.span,{style:{top:"-3em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"mord mathbf",children:"x"})]}),(0,i.jsxs)(e.span,{style:{top:"-3.0134em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"accent-body",style:{left:"-0.1111em"},children:(0,i.jsx)(e.span,{className:"mord",children:"\u02d9"})})]})]})})})}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.8991em"},children:[(0,i.jsxs)(e.span,{style:{top:"-2.453em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]}),(0,i.jsxs)(e.span,{style:{top:"-3.113em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.247em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord",children:"\u2225"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.8641em"},children:(0,i.jsxs)(e.span,{style:{top:"-3.113em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"2"})})]})})})})})]}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsx)(e.span,{className:"mbin",children:"+"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1.1141em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"\u03bb"}),(0,i.jsx)(e.span,{className:"mord",children:"\u2225"}),(0,i.jsx)(e.span,{className:"mord accent",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.6813em"},children:[(0,i.jsxs)(e.span,{style:{top:"-3em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"mord mathbf",children:"q"})]}),(0,i.jsxs)(e.span,{style:{top:"-3.0134em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"accent-body",style:{left:"-0.0556em"},children:(0,i.jsx)(e.span,{className:"mord",children:"\u02d9"})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.1944em"},children:(0,i.jsx)(e.span,{})})})]})}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord",children:"\u2225"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.8641em"},children:(0,i.jsxs)(e.span,{style:{top:"-3.113em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"2"})})]})})})})})]})]})]})]})}),"\n",(0,i.jsx)(e.p,{children:"Where:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"J"}),(0,i.jsx)(e.mi,{children:"i"})]})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\mathbf{J}_i"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.8361em",verticalAlign:"-0.15em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathbf",children:"J"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]})]})})]}),": Jacobian for task ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsx)(e.mi,{children:"i"})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"i"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.6595em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"i"})]})})]})," (e.g., hand position, CoM)"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsxs)(e.msubsup,{children:[(0,i.jsxs)(e.mover,{accent:"true",children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"x"}),(0,i.jsx)(e.mo,{children:"\u02d9"})]}),(0,i.jsx)(e.mi,{children:"i"}),(0,i.jsx)(e.mi,{children:"d"})]})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\dot{\\mathbf{x}}_i^d"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1.1078em",verticalAlign:"-0.2587em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord accent",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.6813em"},children:[(0,i.jsxs)(e.span,{style:{top:"-3em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"mord mathbf",children:"x"})]}),(0,i.jsxs)(e.span,{style:{top:"-3.0134em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"accent-body",style:{left:"-0.1111em"},children:(0,i.jsx)(e.span,{className:"mord",children:"\u02d9"})})]})]})})})}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.8491em"},children:[(0,i.jsxs)(e.span,{style:{top:"-2.4413em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]}),(0,i.jsxs)(e.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2587em"},children:(0,i.jsx)(e.span,{})})})]})})]})]})})]}),": Desired task velocity"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"w"}),(0,i.jsx)(e.mi,{children:"i"})]})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"w_i"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.5806em",verticalAlign:"-0.15em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"w"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0269em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]})]})})]}),": Task weight/priority"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsx)(e.mi,{children:"\u03bb"})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\lambda"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.6944em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"\u03bb"})]})})]}),": Regularization (prefer small joint velocities)"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Closed-Form Solution"})," (damped least squares):"]}),"\n",(0,i.jsx)(e.span,{className:"katex-display",children:(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsxs)(e.mover,{accent:"true",children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"q"}),(0,i.jsx)(e.mo,{children:"\u02d9"})]}),(0,i.jsx)(e.mo,{children:"="}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsxs)(e.msup,{children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"J"}),(0,i.jsx)(e.mi,{children:"T"})]}),(0,i.jsx)(e.mi,{mathvariant:"bold",children:"W"}),(0,i.jsx)(e.mi,{mathvariant:"bold",children:"J"}),(0,i.jsx)(e.mo,{children:"+"}),(0,i.jsx)(e.mi,{children:"\u03bb"}),(0,i.jsx)(e.mi,{mathvariant:"bold",children:"I"}),(0,i.jsxs)(e.msup,{children:[(0,i.jsx)(e.mo,{stretchy:"false",children:")"}),(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mo,{children:"\u2212"}),(0,i.jsx)(e.mn,{children:"1"})]})]}),(0,i.jsxs)(e.msup,{children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"J"}),(0,i.jsx)(e.mi,{children:"T"})]}),(0,i.jsx)(e.mi,{mathvariant:"bold",children:"W"}),(0,i.jsxs)(e.msup,{children:[(0,i.jsxs)(e.mover,{accent:"true",children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"x"}),(0,i.jsx)(e.mo,{children:"\u02d9"})]}),(0,i.jsx)(e.mi,{children:"d"})]})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\dot{\\mathbf{q}} = (\\mathbf{J}^T \\mathbf{W} \\mathbf{J} + \\lambda \\mathbf{I})^{-1} \\mathbf{J}^T \\mathbf{W} \\dot{\\mathbf{x}}^d"})]})})}),(0,i.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.8757em",verticalAlign:"-0.1944em"}}),(0,i.jsx)(e.span,{className:"mord accent",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.6813em"},children:[(0,i.jsxs)(e.span,{style:{top:"-3em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"mord mathbf",children:"q"})]}),(0,i.jsxs)(e.span,{style:{top:"-3.0134em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"accent-body",style:{left:"-0.0556em"},children:(0,i.jsx)(e.span,{className:"mord",children:"\u02d9"})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.1944em"},children:(0,i.jsx)(e.span,{})})})]})}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,i.jsx)(e.span,{className:"mrel",children:"="}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1.1413em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathbf",children:"J"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.8913em"},children:(0,i.jsxs)(e.span,{style:{top:"-3.113em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.13889em"},children:"T"})})]})})})})})]}),(0,i.jsx)(e.span,{className:"mord mathbf",children:"WJ"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsx)(e.span,{className:"mbin",children:"+"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1.1491em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"\u03bb"}),(0,i.jsx)(e.span,{className:"mord mathbf",children:"I"}),(0,i.jsxs)(e.span,{className:"mclose",children:[(0,i.jsx)(e.span,{className:"mclose",children:")"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.8641em"},children:(0,i.jsxs)(e.span,{style:{top:"-3.113em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsxs)(e.span,{className:"mord mtight",children:[(0,i.jsx)(e.span,{className:"mord mtight",children:"\u2212"}),(0,i.jsx)(e.span,{className:"mord mtight",children:"1"})]})})]})})})})})]}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathbf",children:"J"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.8913em"},children:(0,i.jsxs)(e.span,{style:{top:"-3.113em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.13889em"},children:"T"})})]})})})})})]}),(0,i.jsx)(e.span,{className:"mord mathbf",style:{marginRight:"0.01597em"},children:"W"}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord accent",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.6813em"},children:[(0,i.jsxs)(e.span,{style:{top:"-3em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"mord mathbf",children:"x"})]}),(0,i.jsxs)(e.span,{style:{top:"-3.0134em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"accent-body",style:{left:"-0.1111em"},children:(0,i.jsx)(e.span,{className:"mord",children:"\u02d9"})})]})]})})})}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.8991em"},children:(0,i.jsxs)(e.span,{style:{top:"-3.113em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"})})]})})})})})]})]})]})]})}),"\n",(0,i.jsxs)(e.p,{children:["Where ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"W"}),(0,i.jsx)(e.mo,{children:"="}),(0,i.jsx)(e.mtext,{children:"diag"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"w"}),(0,i.jsx)(e.mn,{children:"1"})]}),(0,i.jsx)(e.mo,{separator:"true",children:","}),(0,i.jsx)(e.mo,{children:"\u2026"}),(0,i.jsx)(e.mo,{separator:"true",children:","}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"w"}),(0,i.jsx)(e.mi,{children:"k"})]}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\mathbf{W} = \\text{diag}(w_1, \\ldots, w_k)"})]})})}),(0,i.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.6861em"}}),(0,i.jsx)(e.span,{className:"mord mathbf",style:{marginRight:"0.01597em"},children:"W"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,i.jsx)(e.span,{className:"mrel",children:"="}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord text",children:(0,i.jsx)(e.span,{className:"mord",children:"diag"})}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"w"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3011em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0269em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"1"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mpunct",children:","}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsx)(e.span,{className:"minner",children:"\u2026"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsx)(e.span,{className:"mpunct",children:","}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02691em"},children:"w"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0269em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.03148em"},children:"k"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mclose",children:")"})]})]})]})," are task weights."]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"2-center-of-mass-com-control",children:"2. Center of Mass (CoM) Control"}),"\n",(0,i.jsxs)(e.p,{children:["The CoM position is critical for balance. For a robot with link masses ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"m"}),(0,i.jsx)(e.mi,{children:"i"})]})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"m_i"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.5806em",verticalAlign:"-0.15em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"m"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]})]})})]})," and CoM positions ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"p"}),(0,i.jsx)(e.mi,{children:"i"})]}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsx)(e.mi,{mathvariant:"bold",children:"q"}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\mathbf{p}_i(\\mathbf{q})"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathbf",children:"p"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsx)(e.span,{className:"mord mathbf",children:"q"}),(0,i.jsx)(e.span,{className:"mclose",children:")"})]})})]}),":"]}),"\n",(0,i.jsx)(e.span,{className:"katex-display",children:(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"p"}),(0,i.jsx)(e.mtext,{children:"CoM"})]}),(0,i.jsx)(e.mo,{children:"="}),(0,i.jsxs)(e.mfrac,{children:[(0,i.jsx)(e.mn,{children:"1"}),(0,i.jsx)(e.mi,{children:"M"})]}),(0,i.jsxs)(e.munder,{children:[(0,i.jsx)(e.mo,{children:"\u2211"}),(0,i.jsx)(e.mi,{children:"i"})]}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"m"}),(0,i.jsx)(e.mi,{children:"i"})]}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"p"}),(0,i.jsx)(e.mi,{children:"i"})]}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsx)(e.mi,{mathvariant:"bold",children:"q"}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\mathbf{p}_{\\text{CoM}} = \\frac{1}{M} \\sum_i m_i \\mathbf{p}_i(\\mathbf{q})"})]})})}),(0,i.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.6389em",verticalAlign:"-0.1944em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathbf",children:"p"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3283em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:(0,i.jsx)(e.span,{className:"mord text mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"CoM"})})})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,i.jsx)(e.span,{className:"mrel",children:"="}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"2.5991em",verticalAlign:"-1.2777em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mopen nulldelimiter"}),(0,i.jsx)(e.span,{className:"mfrac",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"1.3214em"},children:[(0,i.jsxs)(e.span,{style:{top:"-2.314em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"mord",children:(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.10903em"},children:"M"})})]}),(0,i.jsxs)(e.span,{style:{top:"-3.23em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,i.jsxs)(e.span,{style:{top:"-3.677em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"mord",children:(0,i.jsx)(e.span,{className:"mord",children:"1"})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.686em"},children:(0,i.jsx)(e.span,{})})})]})}),(0,i.jsx)(e.span,{className:"mclose nulldelimiter"})]}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsx)(e.span,{className:"mop op-limits",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"1.05em"},children:[(0,i.jsxs)(e.span,{style:{top:"-1.8723em",marginLeft:"0em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3.05em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]}),(0,i.jsxs)(e.span,{style:{top:"-3.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3.05em"}}),(0,i.jsx)(e.span,{children:(0,i.jsx)(e.span,{className:"mop op-symbol large-op",children:"\u2211"})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"1.2777em"},children:(0,i.jsx)(e.span,{})})})]})}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"m"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathbf",children:"p"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsx)(e.span,{className:"mord mathbf",children:"q"}),(0,i.jsx)(e.span,{className:"mclose",children:")"})]})]})]})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"CoM Jacobian"}),":"]}),"\n",(0,i.jsx)(e.span,{className:"katex-display",children:(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"J"}),(0,i.jsx)(e.mtext,{children:"CoM"})]}),(0,i.jsx)(e.mo,{children:"="}),(0,i.jsxs)(e.mfrac,{children:[(0,i.jsx)(e.mn,{children:"1"}),(0,i.jsx)(e.mi,{children:"M"})]}),(0,i.jsxs)(e.munder,{children:[(0,i.jsx)(e.mo,{children:"\u2211"}),(0,i.jsx)(e.mi,{children:"i"})]}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"m"}),(0,i.jsx)(e.mi,{children:"i"})]}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"J"}),(0,i.jsx)(e.mi,{children:"i"})]})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\mathbf{J}_{\\text{CoM}} = \\frac{1}{M} \\sum_i m_i \\mathbf{J}_i"})]})})}),(0,i.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.8361em",verticalAlign:"-0.15em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathbf",children:"J"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3283em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:(0,i.jsx)(e.span,{className:"mord text mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"CoM"})})})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,i.jsx)(e.span,{className:"mrel",children:"="}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"2.5991em",verticalAlign:"-1.2777em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mopen nulldelimiter"}),(0,i.jsx)(e.span,{className:"mfrac",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"1.3214em"},children:[(0,i.jsxs)(e.span,{style:{top:"-2.314em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"mord",children:(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.10903em"},children:"M"})})]}),(0,i.jsxs)(e.span,{style:{top:"-3.23em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,i.jsxs)(e.span,{style:{top:"-3.677em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"mord",children:(0,i.jsx)(e.span,{className:"mord",children:"1"})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.686em"},children:(0,i.jsx)(e.span,{})})})]})}),(0,i.jsx)(e.span,{className:"mclose nulldelimiter"})]}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsx)(e.span,{className:"mop op-limits",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"1.05em"},children:[(0,i.jsxs)(e.span,{style:{top:"-1.8723em",marginLeft:"0em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3.05em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]}),(0,i.jsxs)(e.span,{style:{top:"-3.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3.05em"}}),(0,i.jsx)(e.span,{children:(0,i.jsx)(e.span,{className:"mop op-symbol large-op",children:"\u2211"})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"1.2777em"},children:(0,i.jsx)(e.span,{})})})]})}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"m"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathbf",children:"J"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]})]})]})]})}),"\n",(0,i.jsxs)(e.p,{children:["Where ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"J"}),(0,i.jsx)(e.mi,{children:"i"})]})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\mathbf{J}_i"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.8361em",verticalAlign:"-0.15em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathbf",children:"J"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]})]})})]})," is the position Jacobian for link ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsx)(e.mi,{children:"i"})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"i"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.6595em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"i"})]})})]}),"."]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"3-task-prioritization",children:"3. Task Prioritization"}),"\n",(0,i.jsxs)(e.p,{children:["When tasks conflict (e.g., reach target while keeping CoM centered), use ",(0,i.jsx)(e.strong,{children:"prioritized IK"}),":"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Primary task"})," (highest priority, e.g., balance/CoM)"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Secondary task"})," (e.g., hand position)"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Tertiary task"})," (e.g., joint limits, posture)"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Null-Space Projection"}),": Execute secondary task in null space of primary task:"]}),"\n",(0,i.jsx)(e.span,{className:"katex-display",children:(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsxs)(e.mover,{accent:"true",children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"q"}),(0,i.jsx)(e.mo,{children:"\u02d9"})]}),(0,i.jsx)(e.mo,{children:"="}),(0,i.jsxs)(e.msubsup,{children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"J"}),(0,i.jsx)(e.mn,{children:"1"}),(0,i.jsx)(e.mo,{children:"\u2020"})]}),(0,i.jsxs)(e.msub,{children:[(0,i.jsxs)(e.mover,{accent:"true",children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"x"}),(0,i.jsx)(e.mo,{children:"\u02d9"})]}),(0,i.jsx)(e.mn,{children:"1"})]}),(0,i.jsx)(e.mo,{children:"+"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsx)(e.mi,{mathvariant:"bold",children:"I"}),(0,i.jsx)(e.mo,{children:"\u2212"}),(0,i.jsxs)(e.msubsup,{children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"J"}),(0,i.jsx)(e.mn,{children:"1"}),(0,i.jsx)(e.mo,{children:"\u2020"})]}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"J"}),(0,i.jsx)(e.mn,{children:"1"})]}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"}),(0,i.jsxs)(e.msubsup,{children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"J"}),(0,i.jsx)(e.mn,{children:"2"}),(0,i.jsx)(e.mo,{children:"\u2020"})]}),(0,i.jsxs)(e.msub,{children:[(0,i.jsxs)(e.mover,{accent:"true",children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"x"}),(0,i.jsx)(e.mo,{children:"\u02d9"})]}),(0,i.jsx)(e.mn,{children:"2"})]})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\dot{\\mathbf{q}} = \\mathbf{J}_1^\\dagger \\dot{\\mathbf{x}}_1 + (\\mathbf{I} - \\mathbf{J}_1^\\dagger \\mathbf{J}_1) \\mathbf{J}_2^\\dagger \\dot{\\mathbf{x}}_2"})]})})}),(0,i.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.8757em",verticalAlign:"-0.1944em"}}),(0,i.jsx)(e.span,{className:"mord accent",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.6813em"},children:[(0,i.jsxs)(e.span,{style:{top:"-3em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"mord mathbf",children:"q"})]}),(0,i.jsxs)(e.span,{style:{top:"-3.0134em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"accent-body",style:{left:"-0.0556em"},children:(0,i.jsx)(e.span,{className:"mord",children:"\u02d9"})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.1944em"},children:(0,i.jsx)(e.span,{})})})]})}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,i.jsx)(e.span,{className:"mrel",children:"="}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1.2333em",verticalAlign:"-0.2663em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathbf",children:"J"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.967em"},children:[(0,i.jsxs)(e.span,{style:{top:"-2.4337em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"1"})})]}),(0,i.jsxs)(e.span,{style:{top:"-3.1809em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mbin mtight",children:"\u2020"})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2663em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord accent",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.6813em"},children:[(0,i.jsxs)(e.span,{style:{top:"-3em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"mord mathbf",children:"x"})]}),(0,i.jsxs)(e.span,{style:{top:"-3.0134em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"accent-body",style:{left:"-0.1111em"},children:(0,i.jsx)(e.span,{className:"mord",children:"\u02d9"})})]})]})})})}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3011em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"1"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsx)(e.span,{className:"mbin",children:"+"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsx)(e.span,{className:"mord mathbf",children:"I"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1.2333em",verticalAlign:"-0.2663em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathbf",children:"J"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.967em"},children:[(0,i.jsxs)(e.span,{style:{top:"-2.4337em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"1"})})]}),(0,i.jsxs)(e.span,{style:{top:"-3.1809em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mbin mtight",children:"\u2020"})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2663em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathbf",children:"J"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3011em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"1"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mclose",children:")"}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathbf",children:"J"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.967em"},children:[(0,i.jsxs)(e.span,{style:{top:"-2.4337em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"2"})})]}),(0,i.jsxs)(e.span,{style:{top:"-3.1809em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mbin mtight",children:"\u2020"})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2663em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord accent",children:(0,i.jsx)(e.span,{className:"vlist-t",children:(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.6813em"},children:[(0,i.jsxs)(e.span,{style:{top:"-3em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"mord mathbf",children:"x"})]}),(0,i.jsxs)(e.span,{style:{top:"-3.0134em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"accent-body",style:{left:"-0.1111em"},children:(0,i.jsx)(e.span,{className:"mord",children:"\u02d9"})})]})]})})})}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3011em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"2"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]})]})]})]})}),"\n",(0,i.jsxs)(e.p,{children:["Where ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsxs)(e.msubsup,{children:[(0,i.jsx)(e.mi,{mathvariant:"bold",children:"J"}),(0,i.jsx)(e.mn,{children:"1"}),(0,i.jsx)(e.mo,{children:"\u2020"})]})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\mathbf{J}_1^\\dagger"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1.2333em",verticalAlign:"-0.2663em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathbf",children:"J"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.967em"},children:[(0,i.jsxs)(e.span,{style:{top:"-2.4337em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"1"})})]}),(0,i.jsxs)(e.span,{style:{top:"-3.1809em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mbin mtight",children:"\u2020"})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2663em"},children:(0,i.jsx)(e.span,{})})})]})})]})]})})]})," is the pseudoinverse of the primary task Jacobian."]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"interactive-exercises",children:"Interactive Exercises"}),"\n",(0,i.jsx)(e.h3,{id:"exercise-631-center-of-mass-calculator",children:"Exercise 6.3.1: Center of Mass Calculator"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"\"\"\"Compute center of mass for a multi-link robot.\"\"\"\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom typing import List, Tuple\n\ndef forward_kinematics_chain(\n    joint_angles: np.ndarray,\n    link_lengths: np.ndarray,\n    base_pos: np.ndarray = np.array([0.0, 0.0])\n) -> np.ndarray:\n    \"\"\"\n    Compute link endpoint positions for planar serial chain.\n\n    Args:\n        joint_angles: Joint angles (rad), shape (n,)\n        link_lengths: Link lengths (m), shape (n,)\n        base_pos: Base position [x, y] (m)\n\n    Returns:\n        positions: Link endpoints [x, y], shape (n+1, 2)\n    \"\"\"\n    n = len(joint_angles)\n    positions = np.zeros((n + 1, 2))\n    positions[0] = base_pos\n\n    cumulative_angle = 0.0\n    for i in range(n):\n        cumulative_angle += joint_angles[i]\n        positions[i + 1] = positions[i] + link_lengths[i] * np.array([\n            np.cos(cumulative_angle),\n            np.sin(cumulative_angle)\n        ])\n\n    return positions\n\ndef compute_com(\n    link_positions: np.ndarray,\n    link_masses: np.ndarray\n) -> np.ndarray:\n    \"\"\"\n    Compute center of mass from link positions.\n\n    Args:\n        link_positions: Link CoM positions [x, y], shape (n, 2)\n        link_masses: Link masses (kg), shape (n,)\n\n    Returns:\n        com: Center of mass [x, y] (m)\n    \"\"\"\n    total_mass = np.sum(link_masses)\n    com = np.sum(link_positions * link_masses[:, np.newaxis], axis=0) / total_mass\n    return com\n\n# Define 4-link planar humanoid (simplified: torso, thigh, shin, foot)\nlink_lengths = np.array([0.3, 0.4, 0.4, 0.1])  # m\nlink_masses = np.array([20.0, 10.0, 5.0, 2.0])  # kg\n\n# Test different configurations\nconfigs = [\n    (np.array([0.0, 0.0, 0.0, 0.0]), 'Standing Straight'),\n    (np.array([0.0, -0.2, 0.4, -0.2]), 'Slight Crouch'),\n    (np.array([0.3, -0.5, 0.8, -0.3]), 'Deep Crouch')\n]\n\nfig, axes = plt.subplots(1, 3, figsize=(15, 5))\n\nfor ax, (angles, title) in zip(axes, configs):\n    # Compute forward kinematics\n    positions = forward_kinematics_chain(angles, link_lengths)\n\n    # Link CoMs are at midpoints\n    link_com_positions = (positions[:-1] + positions[1:]) / 2\n\n    # Compute overall CoM\n    com = compute_com(link_com_positions, link_masses)\n\n    # Plot robot\n    ax.plot(positions[:, 0], positions[:, 1], 'o-', color='blue',\n            markersize=8, linewidth=3, label='Links')\n\n    # Plot link CoMs\n    ax.scatter(link_com_positions[:, 0], link_com_positions[:, 1],\n               s=link_masses * 10, c='orange', alpha=0.6,\n               edgecolors='black', linewidths=1.5, label='Link CoMs')\n\n    # Plot overall CoM\n    ax.scatter(com[0], com[1], s=300, c='red', marker='X',\n               edgecolors='black', linewidths=2, label='Overall CoM', zorder=10)\n\n    # Support polygon (foot)\n    foot_x = positions[-1, 0]\n    ax.axvspan(foot_x - 0.05, foot_x + 0.05, alpha=0.2, color='green',\n               label='Support')\n\n    # CoM projection\n    ax.plot([com[0], com[0]], [0, com[1]], 'r--', linewidth=2, alpha=0.5,\n            label='CoM Projection')\n\n    ax.set_xlim(-0.2, 0.6)\n    ax.set_ylim(-0.1, 1.3)\n    ax.set_xlabel('X (m)')\n    ax.set_ylabel('Z (m)')\n    ax.set_title(f'{title}\\nCoM X: {com[0]:.3f}m')\n    ax.legend(fontsize=8)\n    ax.grid(True, alpha=0.3)\n    ax.set_aspect('equal')\n\nplt.tight_layout()\nplt.show()\n\n# Analyze stability\nfor angles, title in configs:\n    positions = forward_kinematics_chain(angles, link_lengths)\n    link_coms = (positions[:-1] + positions[1:]) / 2\n    com = compute_com(link_coms, link_masses)\n\n    foot_x = positions[-1, 0]\n    stable = abs(com[0] - foot_x) < 0.05\n\n    print(f\"{title}: CoM at {com[0]:.3f}m, Foot at {foot_x:.3f}m - {'STABLE' if stable else 'UNSTABLE'}\")\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Expected Output"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Standing: CoM directly above foot (stable)"}),"\n",(0,i.jsx)(e.li,{children:"Crouch: CoM shifts forward as joints flex"}),"\n",(0,i.jsx)(e.li,{children:"Visualization shows CoM relative to support polygon"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"What You Learned"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"CoM is mass-weighted average of link positions"}),"\n",(0,i.jsx)(e.li,{children:"Joint configuration significantly affects CoM location"}),"\n",(0,i.jsx)(e.li,{children:"Stability requires CoM projection within support polygon"}),"\n",(0,i.jsx)(e.li,{children:"Crouching can destabilize if not compensated"}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h3,{id:"exercise-632-com-jacobian-and-control",children:"Exercise 6.3.2: CoM Jacobian and Control"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"\"\"\"Compute CoM Jacobian and implement velocity control.\"\"\"\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom typing import Tuple\n\ndef com_jacobian_planar(\n    joint_angles: np.ndarray,\n    link_lengths: np.ndarray,\n    link_masses: np.ndarray\n) -> np.ndarray:\n    \"\"\"\n    Compute CoM Jacobian for planar chain (numerical approximation).\n\n    Args:\n        joint_angles: Joint angles (rad), shape (n,)\n        link_lengths: Link lengths (m), shape (n,)\n        link_masses: Link masses (kg), shape (n,)\n\n    Returns:\n        J_com: CoM Jacobian [2 x n] (m)\n    \"\"\"\n    n = len(joint_angles)\n    J_com = np.zeros((2, n))\n    epsilon = 1e-6\n\n    # Compute current CoM\n    positions = forward_kinematics_chain(joint_angles, link_lengths)\n    link_coms = (positions[:-1] + positions[1:]) / 2\n    com_0 = compute_com(link_coms, link_masses)\n\n    # Numerical derivative for each joint\n    for i in range(n):\n        angles_perturbed = joint_angles.copy()\n        angles_perturbed[i] += epsilon\n\n        positions_p = forward_kinematics_chain(angles_perturbed, link_lengths)\n        link_coms_p = (positions_p[:-1] + positions_p[1:]) / 2\n        com_p = compute_com(link_coms_p, link_masses)\n\n        J_com[:, i] = (com_p - com_0) / epsilon\n\n    return J_com\n\ndef com_velocity_control(\n    current_angles: np.ndarray,\n    com_velocity_desired: np.ndarray,\n    link_lengths: np.ndarray,\n    link_masses: np.ndarray,\n    damping: float = 0.01\n) -> np.ndarray:\n    \"\"\"\n    Compute joint velocities to achieve desired CoM velocity.\n\n    Args:\n        current_angles: Current joint angles (rad), shape (n,)\n        com_velocity_desired: Desired CoM velocity [vx, vy] (m/s)\n        link_lengths: Link lengths (m)\n        link_masses: Link masses (kg)\n        damping: Damping factor for pseudoinverse\n\n    Returns:\n        joint_velocities: Joint velocities (rad/s), shape (n,)\n    \"\"\"\n    J_com = com_jacobian_planar(current_angles, link_lengths, link_masses)\n\n    # Damped least squares pseudoinverse\n    J_pinv = np.linalg.solve(\n        J_com.T @ J_com + damping * np.eye(len(current_angles)),\n        J_com.T\n    )\n\n    joint_velocities = J_pinv @ com_velocity_desired\n    return joint_velocities\n\n# Test: Control CoM to move horizontally\nlink_lengths = np.array([0.3, 0.4, 0.4, 0.1])\nlink_masses = np.array([20.0, 10.0, 5.0, 2.0])\n\n# Initial configuration (standing)\nq0 = np.array([0.0, -0.1, 0.2, -0.1])\n\n# Simulate CoM control\ndt = 0.05\nduration = 2.0\ntimes = np.arange(0, duration, dt)\n\nq_history = np.zeros((len(times), len(q0)))\ncom_history = np.zeros((len(times), 2))\nq_history[0] = q0\n\n# Desired CoM velocity (move forward at 0.1 m/s)\ncom_vel_desired = np.array([0.1, 0.0])\n\nfor i in range(len(times) - 1):\n    # Compute joint velocities for desired CoM motion\n    q_dot = com_velocity_control(\n        q_history[i], com_vel_desired, link_lengths, link_masses\n    )\n\n    # Integrate (Euler)\n    q_history[i + 1] = q_history[i] + q_dot * dt\n\n    # Compute CoM\n    positions = forward_kinematics_chain(q_history[i], link_lengths)\n    link_coms = (positions[:-1] + positions[1:]) / 2\n    com_history[i] = compute_com(link_coms, link_masses)\n\n# Final CoM\npositions_final = forward_kinematics_chain(q_history[-1], link_lengths)\nlink_coms_final = (positions_final[:-1] + positions_final[1:]) / 2\ncom_history[-1] = compute_com(link_coms_final, link_masses)\n\n# Visualize\nfig, axes = plt.subplots(2, 2, figsize=(12, 10))\n\n# Initial and final configurations\nfor ax, idx, title in zip([axes[0, 0], axes[0, 1]], [0, -1], ['Initial', 'Final']):\n    positions = forward_kinematics_chain(q_history[idx], link_lengths)\n    link_coms = (positions[:-1] + positions[1:]) / 2\n    com = compute_com(link_coms, link_masses)\n\n    ax.plot(positions[:, 0], positions[:, 1], 'o-', color='blue',\n            markersize=8, linewidth=3)\n    ax.scatter(com[0], com[1], s=300, c='red', marker='X',\n               edgecolors='black', linewidths=2, zorder=10)\n    ax.set_xlim(-0.1, 0.5)\n    ax.set_ylim(-0.1, 1.3)\n    ax.set_xlabel('X (m)')\n    ax.set_ylabel('Z (m)')\n    ax.set_title(f'{title} Config (t={times[idx]:.1f}s)')\n    ax.grid(True, alpha=0.3)\n    ax.set_aspect('equal')\n\n# CoM trajectory\naxes[1, 0].plot(com_history[:, 0], com_history[:, 1], 'r-', linewidth=2, label='Actual')\naxes[1, 0].plot([com_history[0, 0], com_history[0, 0] + com_vel_desired[0] * duration],\n                [com_history[0, 1], com_history[0, 1] + com_vel_desired[1] * duration],\n                'g--', linewidth=2, label='Desired')\naxes[1, 0].set_xlabel('CoM X (m)')\naxes[1, 0].set_ylabel('CoM Z (m)')\naxes[1, 0].set_title('CoM Trajectory')\naxes[1, 0].legend()\naxes[1, 0].grid(True, alpha=0.3)\naxes[1, 0].axis('equal')\n\n# Joint angles over time\nfor i in range(len(q0)):\n    axes[1, 1].plot(times, np.rad2deg(q_history[:, i]), linewidth=2, label=f'Joint {i+1}')\naxes[1, 1].set_xlabel('Time (s)')\naxes[1, 1].set_ylabel('Joint Angle (degrees)')\naxes[1, 1].set_title('Joint Trajectories')\naxes[1, 1].legend()\naxes[1, 1].grid(True, alpha=0.3)\n\nplt.tight_layout()\nplt.show()\n\n# Analyze tracking\ncom_vel_actual = np.diff(com_history, axis=0) / dt\ncom_vel_avg = np.mean(com_vel_actual, axis=0)\nprint(f\"Desired CoM velocity: {com_vel_desired}\")\nprint(f\"Actual CoM velocity (avg): {com_vel_avg}\")\nprint(f\"Tracking error: {np.linalg.norm(com_vel_avg - com_vel_desired):.4f} m/s\")\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Expected Output"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"CoM moves forward approximately at desired velocity"}),"\n",(0,i.jsx)(e.li,{children:"Joint angles adjust to maintain CoM motion"}),"\n",(0,i.jsx)(e.li,{children:"Some tracking error due to numerical integration and damping"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"What You Learned"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"CoM Jacobian maps joint velocities to CoM velocity"}),"\n",(0,i.jsx)(e.li,{children:"Pseudoinverse enables velocity-level control"}),"\n",(0,i.jsx)(e.li,{children:"Multiple joint solutions exist for same CoM motion (redundancy)"}),"\n",(0,i.jsx)(e.li,{children:"Damping improves numerical stability"}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h3,{id:"exercise-633-task-prioritization-com--end-effector",children:"Exercise 6.3.3: Task Prioritization (CoM + End-Effector)"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"\"\"\"Implement prioritized IK: primary CoM control, secondary hand reaching.\"\"\"\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom typing import Tuple\n\ndef end_effector_jacobian_planar(\n    joint_angles: np.ndarray,\n    link_lengths: np.ndarray\n) -> np.ndarray:\n    \"\"\"\n    Compute end-effector Jacobian for planar chain (numerical).\n\n    Args:\n        joint_angles: Joint angles (rad), shape (n,)\n        link_lengths: Link lengths (m), shape (n,)\n\n    Returns:\n        J_ee: End-effector Jacobian [2 x n]\n    \"\"\"\n    n = len(joint_angles)\n    J_ee = np.zeros((2, n))\n    epsilon = 1e-6\n\n    positions_0 = forward_kinematics_chain(joint_angles, link_lengths)\n    ee_0 = positions_0[-1]\n\n    for i in range(n):\n        angles_p = joint_angles.copy()\n        angles_p[i] += epsilon\n        positions_p = forward_kinematics_chain(angles_p, link_lengths)\n        ee_p = positions_p[-1]\n        J_ee[:, i] = (ee_p - ee_0) / epsilon\n\n    return J_ee\n\ndef prioritized_ik(\n    current_angles: np.ndarray,\n    com_velocity_desired: np.ndarray,\n    ee_velocity_desired: np.ndarray,\n    link_lengths: np.ndarray,\n    link_masses: np.ndarray,\n    damping: float = 0.01\n) -> np.ndarray:\n    \"\"\"\n    Compute joint velocities with prioritized tasks.\n\n    Priority:\n        1. CoM control (primary)\n        2. End-effector reaching (secondary, in null space of CoM)\n\n    Args:\n        current_angles: Current joint angles (rad)\n        com_velocity_desired: Desired CoM velocity [vx, vy] (m/s)\n        ee_velocity_desired: Desired end-effector velocity [vx, vy] (m/s)\n        link_lengths: Link lengths (m)\n        link_masses: Link masses (kg)\n        damping: Damping factor\n\n    Returns:\n        joint_velocities: Joint velocities (rad/s)\n    \"\"\"\n    # Primary task: CoM\n    J_com = com_jacobian_planar(current_angles, link_lengths, link_masses)\n    J_com_pinv = np.linalg.solve(\n        J_com.T @ J_com + damping * np.eye(len(current_angles)),\n        J_com.T\n    )\n    q_dot_primary = J_com_pinv @ com_velocity_desired\n\n    # Null space projector\n    N = np.eye(len(current_angles)) - J_com_pinv @ J_com\n\n    # Secondary task: End-effector\n    J_ee = end_effector_jacobian_planar(current_angles, link_lengths)\n    J_ee_null = J_ee @ N  # Project EE Jacobian into CoM null space\n    J_ee_null_pinv = np.linalg.solve(\n        J_ee_null.T @ J_ee_null + damping * np.eye(len(current_angles)),\n        J_ee_null.T\n    )\n\n    # Secondary contribution (only affects null space)\n    q_dot_secondary = N @ J_ee_null_pinv @ (ee_velocity_desired - J_ee @ q_dot_primary)\n\n    # Combined solution\n    q_dot = q_dot_primary + q_dot_secondary\n\n    return q_dot\n\n# Test: Keep CoM fixed while moving end-effector\nlink_lengths = np.array([0.3, 0.4, 0.4, 0.1])\nlink_masses = np.array([20.0, 10.0, 5.0, 2.0])\n\nq0 = np.array([0.0, -0.1, 0.2, -0.1])\n\ndt = 0.05\nduration = 3.0\ntimes = np.arange(0, duration, dt)\n\nq_history = np.zeros((len(times), len(q0)))\ncom_history = np.zeros((len(times), 2))\nee_history = np.zeros((len(times), 2))\nq_history[0] = q0\n\n# Desired velocities\ncom_vel_des = np.array([0.0, 0.0])  # Keep CoM fixed\nee_vel_des = np.array([0.05, 0.03])  # Move EE diagonally\n\nfor i in range(len(times) - 1):\n    q_dot = prioritized_ik(\n        q_history[i], com_vel_des, ee_vel_des,\n        link_lengths, link_masses\n    )\n\n    q_history[i + 1] = q_history[i] + q_dot * dt\n\n    # Record CoM and EE\n    positions = forward_kinematics_chain(q_history[i], link_lengths)\n    link_coms = (positions[:-1] + positions[1:]) / 2\n    com_history[i] = compute_com(link_coms, link_masses)\n    ee_history[i] = positions[-1]\n\n# Final state\npositions_final = forward_kinematics_chain(q_history[-1], link_lengths)\nlink_coms_final = (positions_final[:-1] + positions_final[1:]) / 2\ncom_history[-1] = compute_com(link_coms_final, link_masses)\nee_history[-1] = positions_final[-1]\n\n# Visualize\nfig, axes = plt.subplots(2, 2, figsize=(12, 10))\n\n# Configuration snapshots\nfor ax, idx, title in zip([axes[0, 0], axes[0, 1]], [0, -1], ['Initial', 'Final']):\n    positions = forward_kinematics_chain(q_history[idx], link_lengths)\n    link_coms = (positions[:-1] + positions[1:]) / 2\n    com = compute_com(link_coms, link_masses)\n\n    ax.plot(positions[:, 0], positions[:, 1], 'o-', color='blue',\n            markersize=8, linewidth=3, label='Robot')\n    ax.scatter(com[0], com[1], s=300, c='red', marker='X',\n               edgecolors='black', linewidths=2, label='CoM', zorder=10)\n    ax.scatter(positions[-1, 0], positions[-1, 1], s=200, c='green',\n               marker='*', edgecolors='black', linewidths=2, label='EE', zorder=10)\n\n    ax.set_xlim(-0.2, 0.6)\n    ax.set_ylim(-0.1, 1.4)\n    ax.set_xlabel('X (m)')\n    ax.set_ylabel('Z (m)')\n    ax.set_title(title)\n    ax.legend()\n    ax.grid(True, alpha=0.3)\n    ax.set_aspect('equal')\n\n# CoM trajectory (should be nearly stationary)\naxes[1, 0].plot(com_history[:, 0], com_history[:, 1], 'r-', linewidth=2, marker='o', markersize=3)\naxes[1, 0].scatter(com_history[0, 0], com_history[0, 1], s=200, c='green',\n                   marker='o', edgecolors='black', linewidths=2, label='Start', zorder=10)\naxes[1, 0].set_xlabel('CoM X (m)')\naxes[1, 0].set_ylabel('CoM Z (m)')\naxes[1, 0].set_title('CoM Trajectory (Should Stay Fixed)')\naxes[1, 0].legend()\naxes[1, 0].grid(True, alpha=0.3)\naxes[1, 0].axis('equal')\n\n# EE trajectory\naxes[1, 1].plot(ee_history[:, 0], ee_history[:, 1], 'g-', linewidth=2, marker='o', markersize=3)\naxes[1, 1].scatter(ee_history[0, 0], ee_history[0, 1], s=200, c='blue',\n                   marker='o', edgecolors='black', linewidths=2, label='Start', zorder=10)\naxes[1, 1].set_xlabel('EE X (m)')\naxes[1, 1].set_ylabel('EE Z (m)')\naxes[1, 1].set_title('End-Effector Trajectory')\naxes[1, 1].legend()\naxes[1, 1].grid(True, alpha=0.3)\naxes[1, 1].axis('equal')\n\nplt.tight_layout()\nplt.show()\n\n# Analyze\ncom_drift = np.linalg.norm(com_history[-1] - com_history[0])\nee_displacement = np.linalg.norm(ee_history[-1] - ee_history[0])\n\nprint(f\"CoM drift: {com_drift * 100:.2f} cm (should be ~0)\")\nprint(f\"EE displacement: {ee_displacement * 100:.1f} cm\")\nprint(f\"EE velocity achieved: {ee_displacement / duration:.3f} m/s (desired: {np.linalg.norm(ee_vel_des):.3f} m/s)\")\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Expected Output"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"CoM stays nearly fixed (drift < 2cm)"}),"\n",(0,i.jsx)(e.li,{children:"End-effector moves diagonally as commanded"}),"\n",(0,i.jsx)(e.li,{children:"Joint configuration changes to accommodate both tasks"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"What You Learned"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Prioritized IK satisfies primary task exactly, secondary task optimally"}),"\n",(0,i.jsx)(e.li,{children:"Null-space projection allows secondary task without violating primary"}),"\n",(0,i.jsx)(e.li,{children:"CoM control (balance) typically has highest priority"}),"\n",(0,i.jsx)(e.li,{children:"Redundancy enables simultaneous task achievement"}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h3,{id:"exercise-634-joint-limit-avoidance",children:"Exercise 6.3.4: Joint Limit Avoidance"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"\"\"\"Add joint limit avoidance as tertiary task.\"\"\"\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom typing import Tuple\n\ndef joint_limit_cost_gradient(\n    joint_angles: np.ndarray,\n    joint_limits: np.ndarray,\n    margin: float = 0.1\n) -> np.ndarray:\n    \"\"\"\n    Compute gradient of joint limit cost (repulsive potential).\n\n    Args:\n        joint_angles: Current joint angles (rad), shape (n,)\n        joint_limits: Joint limits [min, max] (rad), shape (n, 2)\n        margin: Activation margin from limits (rad)\n\n    Returns:\n        gradient: Cost gradient (pushes away from limits), shape (n,)\n    \"\"\"\n    gradient = np.zeros_like(joint_angles)\n\n    for i, (q, (q_min, q_max)) in enumerate(zip(joint_angles, joint_limits)):\n        # Repulsion from lower limit\n        if q - q_min < margin:\n            gradient[i] -= 1.0 / (q - q_min + 1e-6)**2\n\n        # Repulsion from upper limit\n        if q_max - q < margin:\n            gradient[i] += 1.0 / (q_max - q + 1e-6)**2\n\n    return gradient\n\ndef prioritized_ik_with_limits(\n    current_angles: np.ndarray,\n    com_velocity_desired: np.ndarray,\n    ee_velocity_desired: np.ndarray,\n    link_lengths: np.ndarray,\n    link_masses: np.ndarray,\n    joint_limits: np.ndarray,\n    alpha_limits: float = 0.05,\n    damping: float = 0.01\n) -> np.ndarray:\n    \"\"\"\n    Prioritized IK with joint limit avoidance as tertiary task.\n\n    Args:\n        current_angles: Current joint angles (rad)\n        com_velocity_desired: Desired CoM velocity\n        ee_velocity_desired: Desired EE velocity\n        link_lengths: Link lengths\n        link_masses: Link masses\n        joint_limits: Joint limits [min, max] per joint, shape (n, 2)\n        alpha_limits: Gain for limit avoidance\n        damping: Damping factor\n\n    Returns:\n        joint_velocities: Joint velocities (rad/s)\n    \"\"\"\n    # Primary: CoM\n    J_com = com_jacobian_planar(current_angles, link_lengths, link_masses)\n    J_com_pinv = np.linalg.solve(\n        J_com.T @ J_com + damping * np.eye(len(current_angles)),\n        J_com.T\n    )\n    q_dot_primary = J_com_pinv @ com_velocity_desired\n    N1 = np.eye(len(current_angles)) - J_com_pinv @ J_com\n\n    # Secondary: EE\n    J_ee = end_effector_jacobian_planar(current_angles, link_lengths)\n    J_ee_null = J_ee @ N1\n    J_ee_null_pinv = np.linalg.solve(\n        J_ee_null.T @ J_ee_null + damping * np.eye(len(current_angles)),\n        J_ee_null.T\n    )\n    q_dot_secondary = N1 @ J_ee_null_pinv @ (ee_velocity_desired - J_ee @ q_dot_primary)\n    N2 = N1 @ (np.eye(len(current_angles)) - J_ee_null_pinv @ J_ee_null)\n\n    # Tertiary: Joint limit avoidance (gradient descent in null space)\n    limit_gradient = joint_limit_cost_gradient(current_angles, joint_limits)\n    q_dot_tertiary = -alpha_limits * N2 @ limit_gradient\n\n    return q_dot_primary + q_dot_secondary + q_dot_tertiary\n\n# Test with restrictive joint limits\nlink_lengths = np.array([0.3, 0.4, 0.4, 0.1])\nlink_masses = np.array([20.0, 10.0, 5.0, 2.0])\n\n# Joint limits (more restrictive than typical)\njoint_limits = np.array([\n    [-0.5, 0.5],   # Joint 1\n    [-0.8, 0.2],   # Joint 2\n    [-0.2, 1.0],   # Joint 3\n    [-0.5, 0.1]    # Joint 4\n])\n\nq0 = np.array([0.0, -0.1, 0.2, -0.05])\n\ndt = 0.05\nduration = 4.0\ntimes = np.arange(0, duration, dt)\n\nq_history = np.zeros((len(times), len(q0)))\nq_history[0] = q0\n\n# Push EE in direction that would violate joint limits\ncom_vel_des = np.array([0.0, 0.0])\nee_vel_des = np.array([0.1, -0.05])\n\nfor i in range(len(times) - 1):\n    q_dot = prioritized_ik_with_limits(\n        q_history[i], com_vel_des, ee_vel_des,\n        link_lengths, link_masses, joint_limits,\n        alpha_limits=0.1\n    )\n\n    q_history[i + 1] = q_history[i] + q_dot * dt\n\n# Visualize joint angles vs. limits\nfig, axes = plt.subplots(2, 2, figsize=(12, 8))\n\nfor i, ax in enumerate(axes.flat):\n    if i < len(q0):\n        ax.plot(times, np.rad2deg(q_history[:, i]), 'b-', linewidth=2, label='Angle')\n        ax.axhline(np.rad2deg(joint_limits[i, 0]), color='red', linestyle='--',\n                   linewidth=2, label='Lower Limit')\n        ax.axhline(np.rad2deg(joint_limits[i, 1]), color='red', linestyle='--',\n                   linewidth=2, label='Upper Limit')\n\n        # Check violations\n        violations = (q_history[:, i] < joint_limits[i, 0]) | (q_history[:, i] > joint_limits[i, 1])\n        if np.any(violations):\n            ax.fill_between(times, -90, 90, where=violations, alpha=0.3,\n                            color='red', label='Violation')\n\n        ax.set_xlabel('Time (s)')\n        ax.set_ylabel('Angle (degrees)')\n        ax.set_title(f'Joint {i+1}')\n        ax.legend()\n        ax.grid(True, alpha=0.3)\n        ax.set_ylim(-90, 90)\n\nplt.tight_layout()\nplt.show()\n\n# Check for violations\nfor i in range(len(q0)):\n    min_angle = np.rad2deg(q_history[:, i].min())\n    max_angle = np.rad2deg(q_history[:, i].max())\n    limit_min = np.rad2deg(joint_limits[i, 0])\n    limit_max = np.rad2deg(joint_limits[i, 1])\n\n    violated = min_angle < limit_min or max_angle > limit_max\n\n    print(f\"Joint {i+1}: Range [{min_angle:.1f}\xb0, {max_angle:.1f}\xb0], \" +\n          f\"Limits [{limit_min:.1f}\xb0, {limit_max:.1f}\xb0] - {'VIOLATED' if violated else 'OK'}\")\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Expected Output"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Joint angles stay within specified limits"}),"\n",(0,i.jsx)(e.li,{children:"Repulsive gradient pushes joints away as they approach limits"}),"\n",(0,i.jsx)(e.li,{children:"EE motion may be slowed/modified to respect constraints"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"What You Learned"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Tertiary tasks use null space of primary + secondary tasks"}),"\n",(0,i.jsx)(e.li,{children:"Gradient descent in null space optimizes posture without affecting higher tasks"}),"\n",(0,i.jsx)(e.li,{children:"Joint limit avoidance prevents hardware damage and singularities"}),"\n",(0,i.jsx)(e.li,{children:"Multi-level prioritization handles complex constraint hierarchies"}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"trywithai-exercises",children:"TryWithAI Exercises"}),"\n",(0,i.jsx)(e.h3,{id:"trywithai-631-reaching-while-walking",children:"TryWithAI 6.3.1: Reaching While Walking"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Prompt"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"Implement a whole-body planner for a humanoid that reaches for an object while walking. The system should:\n\n1. Generate a walking gait (from Lesson 6.1) with CoM trajectory\n2. Plan arm reaching motion to grasp target at specified time during gait\n3. Use prioritized IK: (1) ZMP/CoM, (2) swing foot, (3) hand position\n4. Ensure arm motion doesn't destabilize walking (check ZMP bounds)\n5. Visualize the robot at key phases and show CoM/ZMP trajectories\n\nTest with target at different heights and lateral positions. Show how reach timing affects feasibility (can't reach during single support if too far).\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Expected Skills"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Multi-phase motion planning"}),"\n",(0,i.jsx)(e.li,{children:"Task synchronization (gait + manipulation)"}),"\n",(0,i.jsx)(e.li,{children:"Dynamic feasibility checking"}),"\n",(0,i.jsx)(e.li,{children:"3D visualization of humanoid configuration"}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h3,{id:"trywithai-632-self-collision-avoidance",children:"TryWithAI 6.3.2: Self-Collision Avoidance"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Prompt"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"Add self-collision avoidance to whole-body IK. Given a simplified humanoid model with cylindrical link volumes:\n\n1. Detect potential collisions between non-adjacent links\n2. Compute collision cost gradient (distance-based repulsive potential)\n3. Integrate collision avoidance as a low-priority task in the IK hierarchy\n4. Visualize configuration space (2-joint subspace) showing collision regions\n\nTest with motions that naturally cause collisions (e.g., touching knee to chest, crossing arms). Show how avoidance modifies trajectories to maintain clearance.\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Expected Skills"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Geometric collision detection"}),"\n",(0,i.jsx)(e.li,{children:"Gradient-based collision avoidance"}),"\n",(0,i.jsx)(e.li,{children:"Configuration space visualization"}),"\n",(0,i.jsx)(e.li,{children:"Balancing task achievement with safety constraints"}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(e.p,{children:"This lesson covered whole-body motion planning for humanoid robots:"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Key Concepts"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Whole-body IK handles multiple simultaneous constraints"}),"\n",(0,i.jsx)(e.li,{children:"Center-of-mass Jacobian enables balance control during manipulation"}),"\n",(0,i.jsx)(e.li,{children:"Task prioritization resolves conflicting objectives"}),"\n",(0,i.jsx)(e.li,{children:"Null-space projection exploits redundancy"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Practical Skills"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Computing CoM from link masses and positions"}),"\n",(0,i.jsx)(e.li,{children:"Deriving and using CoM Jacobian"}),"\n",(0,i.jsx)(e.li,{children:"Implementing prioritized IK (primary/secondary/tertiary tasks)"}),"\n",(0,i.jsx)(e.li,{children:"Adding joint limit avoidance"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Next Steps"}),": ",(0,i.jsx)(e.a,{href:"/physical-ai-book/ur/docs/chapter-06/lesson-04",children:"Lesson 6.4"})," introduces compliant control for safe physical interaction."]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Further Reading"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:['Sentis, L., & Khatib, O. (2005). "Synthesis of Whole-Body Behaviors through Hierarchical Control of Behavioral Primitives." ',(0,i.jsx)(e.em,{children:"International Journal of Humanoid Robotics"}),"."]}),"\n",(0,i.jsxs)(e.li,{children:['Kanoun, O., et al. (2011). "Kinematic Control of Redundant Manipulators: Generalizing the Task-Priority Framework to Inequality Task." ',(0,i.jsx)(e.em,{children:"IEEE Transactions on Robotics"}),"."]}),"\n"]})]})}function o(s={}){const{wrapper:e}={...(0,l.R)(),...s.components};return e?(0,i.jsx)(e,{...s,children:(0,i.jsx)(h,{...s})}):h(s)}},8453:(s,e,n)=>{n.d(e,{R:()=>t,x:()=>r});var a=n(6540);const i={},l=a.createContext(i);function t(s){const e=a.useContext(l);return a.useMemo(function(){return"function"==typeof s?s(e):{...e,...s}},[e,s])}function r(s){let e;return e=s.disableParentContext?"function"==typeof s.components?s.components(i):s.components||i:t(s.components),a.createElement(l.Provider,{value:e},s.children)}}}]);